# 변경 이력 (CHANGELOG)

## [1.1.0] - 2025-10-18

### 🏆 대회 시스템 추가

#### 신규 기능
- **팀 구성 기반 대회 생성**
  - 오늘의 팀 구성(라켓팀/셔틀팀)을 선택하여 대회 자동 생성
  - 출석한 선수만 자동 필터링하여 경기 배정
  - 1인당 경기수 설정 가능 (1~10경기)
  - 경기 타입 선택: 레벨별/랜덤/혼복

- **균등 분배 경기 생성 알고리즘**
  - 모든 선수가 설정된 경기수만큼 고르게 참여
  - 우선순위 기반 매칭으로 공정한 배정
  - 레벨 밸런싱으로 실력차 최소화

- **점수 입력 및 관리**
  - 각 경기별 점수 실시간 입력
  - 자동 승패 판정 (무승부 포함)
  - 경기 상태 관리 (대기중/진행중/완료)

- **선수별 통계**
  - 경기수, 승/패/무 자동 집계
  - 승률 자동 계산 및 표시
  - 대회별 성적 관리

#### 신규 페이지
- `/tournament-bracket` - 대회 대진표 생성 및 관리
- `/my-tournament-matches` - 선수별 대회 경기 조회

#### 데이터베이스 변경
- `tournaments` 테이블 생성
  - 대회 기본 정보 (제목, 날짜, 회차, 경기 타입)
  - 팀 구성 연결 (team_assignment_id)
  - 경기 설정 (1인당 경기수, 총 경기수)

- `tournament_matches` 테이블 생성
  - 경기 정보 (팀1, 팀2, 코트, 라운드)
  - 점수 및 승패 정보
  - 경기 상태 관리

- `team_assignments` 테이블 활용
  - 기존 팀 구성 데이터 재사용
  - 라켓팀/셔틀팀 구분 관리

#### 개선 사항
- **정확한 선수 매칭**
  - 출석 데이터와 팀 구성 데이터의 정확한 이름 매칭
  - 레벨 정보 파싱 개선 (`이름(레벨)` 형식)
  - 대소문자 구분 없는 비교
  - 실제 선수 ID 및 정보 사용

- **상세한 로그 출력**
  - 팀 구성 조회 로그
  - 선수 매칭 성공/실패 로그
  - 경기 생성 통계 로그
  - 불참 선수 목록 출력

- **사용자 경험 개선**
  - 직관적인 UI/UX (players-today 스타일)
  - 실시간 데이터 업데이트
  - 명확한 상태 표시 (색상 코딩)

#### 수정된 파일
- `src/app/admin/players-today/page.tsx`
  - 팀 구성 기반 경기 생성 로직 개선
  - 출석한 선수만 필터링하여 배정
  - 정확한 선수 이름 매칭 구현

- `src/app/tournament-bracket/page.tsx`
  - 대회 대진표 페이지 생성
  - 팀 구성 선택 및 대회 생성
  - 경기 목록 표시 및 점수 입력

- `src/app/my-tournament-matches/page.tsx`
  - 선수별 대회 경기 조회 페이지

#### 신규 SQL 파일
- `sql/create_tournament_tables.sql`
  - tournaments 및 tournament_matches 테이블 생성
  - 인덱스 및 외래키 설정

- `sql/add_match_type_column.sql`
  - tournaments 테이블에 match_type 컬럼 추가
  - 기본값 및 주석 설정

#### 문서 추가
- `TOURNAMENT_SYSTEM_GUIDE.md`
  - 대회 시스템 완전 가이드
  - 사용 방법 및 시나리오
  - 알고리즘 상세 설명
  - 문제 해결 가이드

- `README.md` 업데이트
  - 대회 관리 기능 추가
  - 페이지 구조 업데이트
  - 관련 문서 링크 추가

- `CHANGELOG.md` (이 파일)
  - 변경 이력 추적

### 🔧 버그 수정

#### 팀 구성 선수 매칭 오류 수정
**문제:**
- 팀 구성에서 선수를 선택했을 때 잘못된 선수가 배정됨
- 라켓팀 선수가 셔틀팀에 배정되는 등의 혼선
- 출석하지 않은 선수도 경기에 포함됨

**원인:**
- 출석 데이터와 팀 구성 데이터의 이름 형식 불일치
- 단순 문자열 비교로 인한 매칭 오류
- 레벨 정보 파싱 로직 부재

**해결:**
1. 정확한 이름 파싱 구현
   ```typescript
   const parsePlayerName = (nameWithLevel: string) => {
     const match = nameWithLevel.match(/^(.+?)\(([A-Z0-9]+)\)$/);
     if (match) {
       return { name: match[1].trim(), level: match[2].toLowerCase() };
     }
     return { name: nameWithLevel.trim(), level: 'e2' };
   };
   ```

2. 출석 선수 Map 생성 및 정확한 매칭
   ```typescript
   const presentPlayersMap = new Map();
   presentPlayers.forEach(p => {
     presentPlayersMap.set(p.name.trim().toLowerCase(), p);
   });
   
   const presentPlayer = presentPlayersMap.get(normalizedName);
   if (presentPlayer) {
     // 실제 출석 데이터 사용
   }
   ```

3. 상세한 로그로 매칭 검증
   ```
   ✅ 라켓팀 매칭: 김철수(A1) → 김철수
   ⚠️ 라켓팀 불참: 조영재(A1)
   ```

**결과:**
- 100% 정확한 선수 매칭
- 출석한 선수만 경기에 배정
- 라켓팀/셔틀팀 구분 정확히 유지

### 📊 성능 개선
- 선수 매칭 시 Map 자료구조 사용으로 O(1) 검색
- 불필요한 반복문 제거
- 콘솔 로그 최적화

### 🎨 UI/UX 개선
- players-today 페이지 스타일 일관성 유지
- 직관적인 색상 코딩 (녹색: 팀 구성, 보라색: 대회, 파란색: 경기)
- 반응형 레이아웃 개선

### 📝 기술 부채 해결
- 중복 코드 제거
- 타입 안정성 강화
- 에러 처리 개선

---

## [1.0.0] - 2025-10-17 (이전 버전)

### 초기 기능
- 경기 생성 시스템
- 출석 관리
- 경기일 관리
- 회원 관리
- 대시보드

---

## 향후 계획

### [1.2.0] - 예정
- [ ] 토너먼트 형식 대회 지원
- [ ] 리그전 형식 지원
- [ ] 플레이오프 시스템
- [ ] 대회 일정 캘린더
- [ ] 알림 기능 (경기 시작, 점수 입력 완료)

### [1.3.0] - 예정
- [ ] 통계 기능 강화
  - [ ] 기간별 성적 분석
  - [ ] 선수별 상대 전적
  - [ ] 레벨별 승률 통계
- [ ] 모바일 앱 최적화
- [ ] 오프라인 모드 지원

### [2.0.0] - 예정
- [ ] 다중 클럽 지원
- [ ] 클럽 간 대회
- [ ] 랭킹 시스템
- [ ] 소셜 기능 (팀 채팅, 댓글)
